const contractAddress = "TU_CONTRATO_ADDRESS";
const abi = [/* ABI del contrato aquí */];

let web3;
let contract;
let userAccount;

window.onload = async () => {
  if (typeof window.ethereum !== 'undefined') {
    web3 = new Web3(window.ethereum);
    await ethereum.request({ method: 'eth_requestAccounts' });
    const accounts = await web3.eth.getAccounts();
    userAccount = accounts[0];
    contract = new web3.eth.Contract(abi, contractAddress);
    console.log("Conectado a Web3:", userAccount);
  } else {
    alert("MetaMask no está instalado.");
  }
};

async function updateBot() {
  const botId = parseInt(document.getElementById("botId").value);
  const newPrice = web3.utils.toWei(document.getElementById("newPrice").value, 'mwei');
  const newInterest = parseInt(document.getElementById("newInterest").value) * 10000;

  try {
    await contract.methods.updateBotPrice(botId, newPrice).send({ from: userAccount });
    await contract.methods.updateBotInterest(botId, newInterest).send({ from: userAccount });
    alert("Bot actualizado correctamente.");
  } catch (error) {
    console.error(error);
    alert("Error al actualizar el bot.");
  }
}

async function toggleGlobalWithdrawals() {
  const enabled = document.getElementById("globalWithdrawals").value === "true";

  try {
    await contract.methods.toggleAllBotWithdrawals(enabled).send({ from: userAccount });
    alert("Estado de retiros actualizado.");
  } catch (error) {
    console.error(error);
    alert("Error al actualizar retiros.");
  }
}

async function setReward() {
  const user = document.getElementById("userAddress").value;
  const amount = web3.utils.toWei(document.getElementById("rewardAmount").value, 'mwei');
  const botId = parseInt(document.getElementById("botIdReward").value);

  try {
    await contract.methods.setRewardForUser(user, amount, botId).send({ from: userAccount });
    alert("Recompensa asignada.");
  } catch (error) {
    console.error(error);
    alert("Error al asignar recompensa.");
  }
}

async function withdrawUSDT() {
  const amount = web3.utils.toWei(document.getElementById("withdrawAmount").value, 'mwei');

  try {
    await contract.methods.withdrawUSDT(amount).send({ from: userAccount });
    alert("USDT retirado.");
  } catch (error) {
    console.error(error);
    alert("Error al retirar USDT.");
  }
}

async function useFees() {
  const amount = web3.utils.toWei(document.getElementById("feeAmount").value, 'mwei');

  try {
    await contract.methods.useAccumulatedFees(amount).send({ from: userAccount });
    alert("Fees utilizados.");
  } catch (error) {
    console.error(error);
    alert("Error al usar fees.");
  }
}
